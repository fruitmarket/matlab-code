clear all; clc;

Conditions = {'Cond1','Cond2','Cond3'};
% TestDataSet = [2.694353455	0.122105349	3.107526882
% 3.408038933	0.319666816	2.381711008
% 3.167614646	0.860289855	3.341436155
% 15.73131786	0.393018018	1.505853175
% 4.133611493	0.537130458	1.786255411
% 2.90035482	1.024547983	1.594674556
% 1.843462337	0.076573299	1.294258169
% 2.54992737	1.355907781	1.270363758
% 2.983319548	0.581958804	0.370223653
% 2.478002043	0.563643403	0.532203101
% 4.120237203	3.596784168	0.986648969
% 3.222653542	1.633728891	0.300357641
% 4.012380025	0.177271494	1.17865067];

%% Run
% not normalized
% TestDataSet = [0.852529478306378,0.146190429949703,0.348347100378257;
%     5.61643032350302,0,4.18714250136049;
%     2.70809462273197,0.182927251009480,5.79367645731883;
%     0.664433516582070,0,1.23473292323203;
%     4.39148247350382,3.93655580036906,6.31627978391891;
%     10.1608079299624,1.37237426337422,9.98434885181428;
%     11.0107091263232,0.0121365217917905,16.9690783881903;
%     5.37085141953339,2.13445082132944,5.29103937741899;
%     1.81898781621832,0.362245915616578,1.92036594884250;
%     1.34919253779331,0.387089602722948,2.53291406058375;
%     5.20211638833947,5.49430310075736,2.29532731605881;
%     0.826921151186099,1.15271206155575,1.01960539368001];

% normalized
% TestDataSet = [1,0.171478445812950,0.408604170579858;
%     1,0,0.745516682337997;
%     1,0.0675483232653593,2.13939217953695;
%     1,0,1.85832426031675;
%     1,0.896407038880473,1.43830240061948;
%     1,0.135065466529225,0.982633361503885;
%     1,0.00110224706261433,1.54114309927801;
%     1,0.397413865065528,0.985139778429891;
%     1,0.199146971951515,1.05573326644647;
%     1,0.286904642502736,1.87735552164149;
%     1,1.05616689258872,0.441229519816930;
%     1,1.39398062306466,1.23301404519347];

%% Rw 
% not normalized
% TestDataSet = [0.154111638606076,0.0252167959046844,0.113424316795209;
%     0.557541942248941,0.253748252816300,0.768052187675695;
%     0.185154189449604,0.0133719461650823,0.0341566322098896;
%     0.423415260619850,1.08749576473234,0.0287479377466187;
%     3.30890563363527,4.31421062386462,3.91285286884696;
%     7.92168325128978,0.262731335917961,9.94485971792770;
%     5.44448329407757,4.02593575876684,5.01075686932596;
%     3.14169575316408,2.46124720622401,1.93525883098171;
%     7.37561904486566,0.441193270853538,7.40579927991149;
%     1.40710299920298,0.600025871838064,1.20799761268039;
%     0.138618667052272,0,0.0511619634870568;
%     0.305199883728240,0.0148473932951245,0.438419586446755;
%     1.29284466547708,1.96286504566509,1.46585114558005;
%     0.569481254359994,0.348544754216791,0.528806372084444;
%     1.15251363359422,2.04079590994016,1.79676426770907;
%     1.98533773379637,2.43524243958979,1.12121592532477;
%     0.194514954751801,0.401124638850365,0.115561741940777;
%     0.511270511128048,0.0412658969857599,0.169464911446698;
%     0.672100010318671,0.00906574587698818,0.304862905664970;
%     0.203799547905934,0,0.130081901476025;
%     0.347787389283431,0,0.0358604034149151;
%     4.90287626306155,3.06201990667031,6.62266811827613;
%     0.480031480938403,0.0796263869157143,0.178432302349066;
%     1.71433432736621,0.0685619367599391,1.06473466627567;
%     3.99937093552496,0,2.53174202802234;
%     15.8608132016715,0.273830573195557,5.14094989505461;
%     0.570570718056944,0.0106425107215302,0.260759223999630];

% normalized
% TestDataSet = [1,0.163626810620975,0.735988000783851;
%     1,0.455119576821007,1.37756844727703;
%     1,0.0722205973563560,0.184476691083387;
%     1,2.56839057510663,0.0678953746365535;
%     1,1.30381796930391,1.18252174648697;
%     1,0.0331660996260087,1.25539729404209;
%     1,0.739452311874333,0.920336531251109;
%     1,0.783413608318128,0.615991802844899;
%     1,0.0598177953836516,1.00409189179406;
%     1,0.426426403879413,0.858499778171624;
%     1,0,0.369084226352891;
%     1,0.0486480961714425,1.43649984754627;
%     1,1.51825280954442,1.13381845841405;
%     1,0.612039029464630,0.928575555447805;
%     1,1.77073472317697,1.55899610671476;
%     1,1.22661368800617,0.564748206936446;
%     1,2.06217891761688,0.594102094043269;
%     1,0.0807124527771265,0.331458411463624;
%     1,0.0134886858172934,0.453597531594176;
%     1,0,0.638283562513424;1,0,0.103110131419085;
%     1,0.624535424183489,1.35077202909883;
%     1,0.165877426955529,0.371709584546939;
%     1,0.0399933289939268,0.621077609704905;
%     1,0,0.633035061972821;
%     1,0.0172645985873347,0.324129023505102;
%     1,0.0186523955483956,0.457014732350155];
%% Stats

% Average
TestDataSet_Avg = mean(TestDataSet,1);

% SE
TestDataSet_SE = std(TestDataSet,0,1)/sqrt(size(TestDataSet,1));

%% Plot bar graphs

figure;
barweb(TestDataSet_Avg, TestDataSet_SE, [], [], '', '', '', [], [], [], [], []); 
axis square

%%%%%%%%%%
%% contrast analysis for the pattern (2 -1 -1) --> For Figure h, it will be (-1 0 1) for STIM PRE POST
%%%%%%%%%%

%% 1. 1-way ANOVA

% Rearrange data for RMOVA1.m file
TestDataSet_rearranged = zeros(size(TestDataSet,1)*size(TestDataSet,2),3);

TestDataSet_rearranged(:,1) = [TestDataSet(:,1)' TestDataSet(:,2)' TestDataSet(:,3)'];
TestDataSet_rearranged(:,2) = [ones(1,size(TestDataSet,1)) 2*ones(1,size(TestDataSet,1)) 3*ones(1,size(TestDataSet,1))];
TestDataSet_rearranged(:,3) = repmat(1:size(TestDataSet,1), [1 3]);

alpha = 0.05;
ano1_TestDataSet = RMAOV1(TestDataSet_rearranged,alpha);

%% 2. Linear trend analysis for Attn - Away
% SScontrast = L^2/sum(w^2)/N (L = 2 TestDataSetAvg1 + -1 TestDataSetAvg2 + -1 TestDataSetAvg3)

% Contrast_Coeff = [2 -1 -1]; % (Cond1, Cond2, Cond3)
% TestDataSet_Lsq = (2*TestDataSet_Avg(:,1) + (-1)*TestDataSet_Avg(:,2) + (-1)*TestDataSet_Avg(:,3)).^2;

Contrast_Coeff = [-1 0 1]; % (Cond1, Cond2, Cond3)
TestDataSet_Lsq = (Contrast_Coeff(1)*TestDataSet_Avg(:,1) + Contrast_Coeff(2)*TestDataSet_Avg(:,2) + Contrast_Coeff(3)*TestDataSet_Avg(:,3)).^2;

% SScontrast
TestDataSet_SScontrast = TestDataSet_Lsq/(sum(Contrast_Coeff.^2)/size(TestDataSet,1));

% MScontrast
TestDataSet_MScontrast = (TestDataSet_Lsq/(sum(Contrast_Coeff.^2)/size(TestDataSet,1)))/1;

% MSerror
MSerror_TestDataSet = cell2mat(ano1_TestDataSet(3,4));

% dferror
dferror_TestDataSet = cell2mat(ano1_TestDataSet(3,3));

% FContrast
TestDataSet_FContrast = TestDataSet_MScontrast./MSerror_TestDataSet;

% F-table values
Fcrit_TestDataSet = finv(1-alpha,1,dferror_TestDataSet);

if TestDataSet_FContrast >= Fcrit_TestDataSet
   h_TestDataSet_Contrast = 1;
elseif TestDataSet_FContrast < Fcrit_TestDataSet
   h_TestDataSet_Contrast = 0;
end

p_TestDataSet_Contrast = 1 - fcdf(TestDataSet_FContrast,1,dferror_TestDataSet)
